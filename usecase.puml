@startuml

title Система совместного редактирования
left to right direction

actor "Пользователь" as User
actor "Сервер" as Server
actor "WebSocket-сервер" as WS

usecase "Вход в систему" as UC1
usecase "Сохранение изменений" as UC2
usecase "Создание проекта" as UC3
usecase "Приглашение участников" as UC4
usecase "Управление проектами" as UC5
usecase "Редактирование объектов" as UC6


usecase "Аутентификация" as UC7
usecase "Обработка CRUD-запросов" as UC8

usecase "Синхронизация изменений" as UC10
usecase "Сохранение снапшота" as UC11

' WebSocket-специфичные use cases
usecase "Управление WebSocket-подключениями" as UC12
usecase "Широковещательная рассылка изменений" as UC13
usecase "Обработка конфликтов редактирования" as UC14
usecase "Управление активными сессиями" as UC15
usecase "Отслеживание присутствия пользователей" as UC16

User --> UC1
User --> UC2
User --> UC3
User --> UC4
User --> UC5
User -> UC6

 
UC2 ..> UC8 : <<include>>
UC3 ..> UC8 : <<include>>
UC4 ..> UC8 : <<include>>
UC5 ..> UC8 : <<include>>


UC6 .> UC10 : <<include>>

' WebSocket-сервер управляет подключениями и сессиями
WS --> UC12
WS --> UC15
WS --> UC16

' Синхронизация использует широковещательную рассылку
UC10 <-- WS
UC10 ..> UC13 : <<include>>
UC13 <-- WS

' Обработка конфликтов при одновременном редактировании
UC10 ..> UC14 : <<extend>>
UC14 <-- WS

' Сохранение снапшота
WS --> UC11

UC8 <. UC11 : <<include>>

UC1 --> UC7

UC7 <-- Server
UC8 <-- Server

@enduml